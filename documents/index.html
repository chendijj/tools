<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½å•æ®åˆ†ç±»å·¥å…· - Tools Collection</title>
    <!-- å¼•å…¥ä¸»é¢˜æ ·å¼ -->
    <link rel="stylesheet" href="../shared/theme.css">
</head>
<body>
    <div class="min-h-screen" style="background-color: var(--bg-primary)">
        <div class="app-container">
            <!-- æ ‡é¢˜æ  -->
            <header class="header">
                <div class="title-bar">
                    <div class="title-left">
                        <span class="icon">ğŸ“‹</span>
                        <h1>åŠŸèƒ½å•æ®åˆ†ç±»å·¥å…·</h1>
                    </div>
                    <div class="theme-toggle">
                        <button onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
                            <span id="themeIcon">ğŸŒ™</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
            <main style="padding: 20px">
                <div class="animate-fadeIn" style="display: flex; flex-direction: column; gap: 20px">

                    <!-- å·¥å…·æ  -->
                    <div class="toolbar">
                        <div class="toolbar-content">
                            <div class="toolbar-group">
                                <button onclick="processDocument()" class="tool-button primary">
                                    <span>ğŸ”„</span>
                                    å¤„ç†æ–‡æ¡£
                                </button>
                                <button onclick="loadExample(); processDocument();" class="tool-button">
                                    <span>ğŸ“Š</span>
                                    åŠ è½½ç¤ºä¾‹
                                </button>
                            </div>
                            <div class="toolbar-group">
                                <button onclick="copyResult()" class="tool-button success">
                                    <span>ğŸ“‹</span>
                                    å¤åˆ¶ç»“æœ
                                </button>
                                <button onclick="clearAll()" class="tool-button danger">
                                    <span>ğŸ—‘ï¸</span>
                                    æ¸…ç©º
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
                    <div class="input-output-grid">
                        <!-- è¾“å…¥åŒºåŸŸ -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span>ğŸ“</span>
                                    è¾“å…¥æ–‡æ¡£
                                </h3>
                            </div>
                            <div class="card-body">
                                <textarea
                                    id="input"
                                    class="form-control monospace"
                                    style="height: 400px;"
                                    placeholder="è¯·åœ¨æ­¤å¤„ç²˜è´´æ‚¨çš„åŠŸèƒ½å•æ®æ–‡æœ¬...

æ”¯æŒæ ¼å¼ï¼š
ã€ç±»åˆ«ã€‘åŠŸèƒ½åç§°
æˆ–è€…
æ™®é€šåŠŸèƒ½åç§°ï¼ˆå°†å½’ç±»åˆ°"å…¶ä»–"ï¼‰"
                                ></textarea>
                            </div>
                        </div>

                        <!-- è¾“å‡ºåŒºåŸŸ -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <span>ğŸ“Š</span>
                                    åˆ†ç±»ç»“æœ
                                </h3>
                            </div>
                            <div class="card-body">
                                <textarea
                                    id="output"
                                    class="form-control monospace"
                                    style="height: 400px;"
                                    readonly
                                    placeholder="å¤„ç†åçš„åˆ†ç±»ç»“æœå°†åœ¨æ­¤æ˜¾ç¤º..."
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                    <div class="stats" id="stats" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number" id="totalCategories">0</div>
                                <div class="stat-label">ç±»åˆ«æ•°é‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="totalFunctions">0</div>
                                <div class="stat-label">åŠŸèƒ½æ€»æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="categorizedFunctions">0</div>
                                <div class="stat-label">å·²åˆ†ç±»åŠŸèƒ½</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="otherFunctions">0</div>
                                <div class="stat-label">å…¶ä»–åŠŸèƒ½</div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>

        </div>
    </div>

    <!-- Toasté€šçŸ¥ -->
    <div class="toast" id="toast"></div>

    <!-- å¼•å…¥ä¸»é¢˜è„šæœ¬ -->
    <script src="../shared/theme.js"></script>
    
    <!-- å·¥å…·ä¸“æœ‰è„šæœ¬ -->
    <script>
        function processDocument() {
            const input = document.getElementById('input').value.trim();
            if (!input) {
                ToastManager.error('è¯·å…ˆè¾“å…¥æ–‡æ¡£å†…å®¹');
                return;
            }

            try {
                const result = processFunctionDocuments(input);
                document.getElementById('output').value = result.output;
                updateStats(result.stats);
                ToastManager.success('æ–‡æ¡£å¤„ç†å®Œæˆï¼');
            } catch (error) {
                ToastManager.error('å¤„ç†å¤±è´¥ï¼š' + error.message);
            }
        }

        // å…³é”®è¯æ˜ å°„è¡¨ï¼Œç”¨äºåˆå¹¶ç›¸ä¼¼ç±»åˆ«
        function createKeywordMap(categories) {
            const keywordMap = {};
            const categoryKeys = Object.keys(categories);
            
            for (let i = 0; i < categoryKeys.length; i++) {
                const category1 = categoryKeys[i];
                let mergeTarget = category1;
                
                // æŸ¥æ‰¾æ˜¯å¦æœ‰å…¶ä»–ç±»åˆ«æ˜¯å½“å‰ç±»åˆ«çš„å­é›†
                for (let j = 0; j < categoryKeys.length; j++) {
                    if (i !== j) {
                        const category2 = categoryKeys[j];
                        // å¦‚æœcategory1åŒ…å«category2ï¼Œåˆ™å°†category2åˆå¹¶åˆ°category1
                        if (category1.includes(category2) && category2.length < category1.length) {
                            mergeTarget = category2;
                            break;
                        }
                        // å¦‚æœcategory2åŒ…å«category1ï¼Œåˆ™å°†category1åˆå¹¶åˆ°category2
                        else if (category2.includes(category1) && category1.length < category2.length) {
                            mergeTarget = category2;
                            break;
                        }
                    }
                }
                keywordMap[category1] = mergeTarget;
            }
            
            return keywordMap;
        }

        // ä»æ–‡æœ¬ä¸­æå–å…³é”®è¯è¿›è¡Œåˆ†ç±»
        function extractKeywordsFromText(text) {
            // å¸¸è§å…³é”®è¯æ¨¡å¼
            const keywordPatterns = {
                'è‹±é›„': ['è‹±é›„', 'è§’è‰²', 'äººç‰©'],
                'è£…å¤‡': ['è£…å¤‡', 'æ­¦å™¨', 'é“å…·', 'ç‰©å“'],
                'å…³å¡': ['å…³å¡', 'å‰¯æœ¬', 'æˆ˜æ–—', 'boss', 'pve', 'æŒ‘æˆ˜'],
                'ç³»ç»Ÿ': ['ç³»ç»Ÿ', 'åŠŸèƒ½', 'è®¾ç½®', 'é…ç½®'],
                'GM': ['gm', 'ç®¡ç†', 'åå°', 'å·¥å…·'],
                'æ¼”ä¹ ': ['æ¼”ä¹ ', 'ç«æŠ€', 'pvp', 'å¯¹æˆ˜'],
                'å»ºç­‘': ['å»ºç­‘', 'å‡çº§', 'å»ºé€ '],
                'æ€ªç‰©': ['æ€ªç‰©', 'é‡æ€ª', 'æ•Œäºº']
            };
            
            const textLower = text.toLowerCase();
            
            // æŸ¥æ‰¾åŒ¹é…çš„å…³é”®è¯
            for (const [category, patterns] of Object.entries(keywordPatterns)) {
                for (const pattern of patterns) {
                    if (textLower.includes(pattern)) {
                        return category;
                    }
                }
            }
            
            return null;
        }

        function processFunctionDocuments(content) {
            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åŠŸèƒ½å•æ®
            const pattern = /ã€(.*?)ã€‘([^\n]+)/g;
            const matches = [];
            let match;
            
            while ((match = pattern.exec(content)) !== null) {
                matches.push({
                    category: match[1].trim(),
                    functionName: match[2].trim()
                });
            }

            // æŒ‰ç±»åˆ«åˆ†ç±»
            const categories = {};
            
            // å¤„ç†æœ‰ã€ã€‘ç¬¦å·çš„åŠŸèƒ½å•æ®
            matches.forEach(({ category, functionName }) => {
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(functionName);
            });

            // åˆ›å»ºå…³é”®è¯æ˜ å°„è¿›è¡Œç±»åˆ«åˆå¹¶
            const keywordMap = createKeywordMap(categories);
            const mergedCategories = {};
            
            // åˆå¹¶ç›¸ä¼¼ç±»åˆ«
            Object.entries(categories).forEach(([category, functions]) => {
                const targetCategory = keywordMap[category];
                if (!mergedCategories[targetCategory]) {
                    mergedCategories[targetCategory] = [];
                }
                mergedCategories[targetCategory] = mergedCategories[targetCategory].concat(functions);
            });

            // æå–æ²¡æœ‰ã€ã€‘ç¬¦å·çš„è¡Œå¹¶å°è¯•è‡ªåŠ¨åˆ†ç±»
            const lines = content.split('\n');
            const unclassifiedFunctions = [];
            
            lines.forEach(line => {
                line = line.trim();
                if (line && !line.match(/ã€.*?ã€‘/)) {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŒ¹é…è¿‡ï¼ˆé¿å…é‡å¤ï¼‰
                    const isMatched = matches.some(({ functionName }) => 
                        line === functionName.trim()
                    );
                    if (!isMatched) {
                        // å°è¯•åŸºäºå…³é”®è¯è‡ªåŠ¨åˆ†ç±»
                        const detectedCategory = extractKeywordsFromText(line);
                        if (detectedCategory) {
                            if (!mergedCategories[detectedCategory]) {
                                mergedCategories[detectedCategory] = [];
                            }
                            mergedCategories[detectedCategory].push(line);
                        } else {
                            unclassifiedFunctions.push(line);
                        }
                    }
                }
            });

            // æ·»åŠ æœªèƒ½åˆ†ç±»çš„åŠŸèƒ½åˆ°"å…¶ä»–"ç±»åˆ«
            if (unclassifiedFunctions.length > 0) {
                mergedCategories['å…¶ä»–'] = unclassifiedFunctions;
            }

            // ç”Ÿæˆæ ¼å¼åŒ–è¾“å‡º
            const outputLines = [];
            let totalFunctions = 0;
            let categorizedFunctions = 0;

            Object.entries(mergedCategories).forEach(([category, functions]) => {
                // æ·»åŠ ç±»åˆ«æ ‡é¢˜
                outputLines.push(`${category}åŠå…¶å­åŠŸèƒ½å•æ®${functions.length}ä¸ª`);
                
                // æ·»åŠ åºå·åŠŸèƒ½åˆ—è¡¨
                functions.forEach((func, index) => {
                    if (category === 'å…¶ä»–') {
                        outputLines.push(` ${index + 1}ã€${func}`);
                    } else {
                        outputLines.push(` ${index + 1}ã€ã€${category}ã€‘${func}`);
                        categorizedFunctions++;
                    }
                });
                
                // æ·»åŠ ç©ºè¡Œåˆ†éš”
                outputLines.push('');
                totalFunctions += functions.length;
            });

            // ç§»é™¤æœ€åçš„ç©ºè¡Œ
            if (outputLines.length > 0 && outputLines[outputLines.length - 1] === '') {
                outputLines.pop();
            }

            const stats = {
                totalCategories: Object.keys(mergedCategories).length,
                totalFunctions: totalFunctions,
                categorizedFunctions: categorizedFunctions,
                otherFunctions: unclassifiedFunctions.length
            };

            return {
                output: outputLines.join('\n'),
                stats: stats
            };
        }

        function updateStats(stats) {
            document.getElementById('totalCategories').textContent = stats.totalCategories;
            document.getElementById('totalFunctions').textContent = stats.totalFunctions;
            document.getElementById('categorizedFunctions').textContent = stats.categorizedFunctions;
            document.getElementById('otherFunctions').textContent = stats.otherFunctions;
            document.getElementById('stats').style.display = 'block';
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').value = '';
            document.getElementById('stats').style.display = 'none';
            ToastManager.success('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹');
        }

        async function copyResult() {
            const output = document.getElementById('output').value;
            if (!output) {
                ToastManager.error('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }

            const success = await Utils.copyToClipboard(output);
            if (success) {
                ToastManager.success('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } else {
                ToastManager.error('å¤åˆ¶å¤±è´¥');
            }
        }

// ç¤ºä¾‹æ•°æ®åŠ è½½
        function loadExample() {
            const exampleData = `ã€GMã€‘PVETestå…³å¡é€‰æ‹©ï¼Œéœ€è¦æ”¯æŒè¯»å–pve_section_config
ã€è‹±é›„è£…å¤‡ã€‘æ›¿æ¢è£…å¤‡çš„æ—¶å€™éœ€è¦æ”¯æŒè„±ä¸‹åç©¿æˆ´
ã€è‹±é›„è£…å¤‡ã€‘æ›¿æ¢æ­£åœ¨è¢«å…¶ä»–è‹±é›„ç©¿æˆ´çš„è£…å¤‡æ—¶å…ˆå¼¹å‡ºå¯¹æ¯”ç•Œé¢ç„¶åç›´æ¥æ›¿æ¢
ã€è‹±é›„éƒ¨é˜Ÿã€‘è‹±é›„é˜Ÿä¼ç®¡ç†åŠŸèƒ½
ã€è‹±é›„ã€‘è§’è‰²å±æ€§ä¼˜åŒ–
ã€æ¼”ä¹ å®¤ã€‘é˜²å®ˆé˜µå®¹æ¨èè®¾ç½®ä¼˜åŒ–-é¢„åˆ¶
ã€æ¼”ä¹ å®¤ã€‘é˜²å®ˆé˜µå®¹æ¨èè®¾ç½®ä¼˜åŒ–-UI-æ¨èå›¾æ ‡å’Œä½ç½®
pvebosså…³æˆ˜åŠ›æ¨èæŒ‘æˆ˜ï¼Œpveå…³å¡å¡ç‚¹å…·ä½“åˆ°æ¯ä¸ªboss
æ‰“é‡æ€ªé‡ä¼¤ç‡æå‡åˆ°åƒåˆ†ä¹‹1
ã€GMã€‘å®¢æˆ·ç«¯å¢åŠ åè®®å½•åˆ¶ã€å›æ”¾çš„åŠŸèƒ½
pveå¤±è´¥æ¨èï¼Œå»ºç­‘å‡çº§å‰äº”ç« æ”¾åˆ°ç¬¬ä¸€ä½
è£…å¤‡å¼ºåŒ–ç³»ç»Ÿä¼˜åŒ–
æ­¦å™¨å‡çº§ç•Œé¢æ”¹è¿›`;
            
            document.getElementById('input').value = exampleData;
        }
    </script>
</body>
</html>