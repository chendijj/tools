{% extends "base.html" %} {% block title %}ğŸ—‚ï¸ å±€åŸŸç½‘æ–‡ä»¶åˆ†äº«å·¥å…·{% endblock %}
{% block content %}
<header class="header">
  <div class="title-section">
    <div class="title-left">
      <span class="icon">ğŸ—‚ï¸</span>
      <h1>å±€åŸŸç½‘æ–‡ä»¶åˆ†äº«å·¥å…·</h1>
    </div>

    <div class="server-info">
      <div class="server-url-section">
        <div class="url-display">
          <span id="server-url">{{ server_url }}</span>
          <button class="copy-btn" onclick="copyServerUrl()" title="å¤åˆ¶åœ°å€">
            ğŸ“‹
          </button>
        </div>
      </div>

      <div class="qr-section">
        <button class="qr-btn" onclick="toggleQRCode()" title="æ˜¾ç¤ºäºŒç»´ç ">
          ğŸ“±
        </button>
        <div
          id="qr-code-container"
          class="qr-code-container"
          style="display: none"
        >
          <img
            id="qr-code"
            src="data:image/png;base64,{{ qr_code }}"
            alt="äºŒç»´ç "
          />
          <p>æ‰«ç è®¿é—®</p>
        </div>
      </div>
    </div>
  </div>
  <p class="subtitle">ç®€å•å¿«æ·çš„æ–‡ä»¶åˆ†äº«å’Œæ–‡æœ¬ç¼–è¾‘å·¥å…·</p>
</header>

<main class="main-content">
  <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
  <section class="upload-section">
    <div class="section-header">
      <h2>ğŸ“¤ æ–‡ä»¶ä¸Šä¼ </h2>
    </div>
    <div class="section-content">
      <div class="upload-area" id="upload-area">
        <div class="upload-content">
          <span class="upload-icon">ğŸ“</span>
          <p class="upload-text">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
          <p class="upload-hint">æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œå•æ–‡ä»¶æœ€å¤§100MB</p>
          <input type="file" id="file-input" multiple hidden />
          <button
            class="upload-btn"
            onclick="document.getElementById('file-input').click()"
          >
            é€‰æ‹©æ–‡ä»¶
          </button>
        </div>
      </div>

      <div class="upload-progress" id="upload-progress" style="display: none">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <span class="progress-text" id="progress-text">ä¸Šä¼ ä¸­...</span>
      </div>
    </div>
  </section>

  <!-- æ–‡æœ¬ç¼–è¾‘å™¨ -->
  <section class="text-editor-section">
    <div class="section-header">
      <h2>ğŸ“ æ–‡æœ¬ç¼–è¾‘å™¨</h2>
    </div>
    <div class="section-content">
      <div class="editor-controls">
        <input
          type="text"
          id="text-filename"
          placeholder="æ–‡ä»¶å.txt"
          value="æ–°å»ºæ–‡æœ¬.txt"
        />
        <button class="btn btn-primary" onclick="saveTextFile()">
          ğŸ’¾ ä¿å­˜
        </button>
        <button class="btn btn-secondary" onclick="clearEditor()">
          ğŸ—‘ï¸ æ¸…ç©º
        </button>
      </div>
      <textarea id="text-editor" placeholder="åœ¨æ­¤è¾“å…¥æ–‡æœ¬å†…å®¹..."></textarea>
    </div>
  </section>

  <!-- æ–‡ä»¶åˆ—è¡¨ -->
  <section class="file-list-section">
    <div class="section-header">
      <h2>ğŸ“ æ–‡ä»¶åˆ—è¡¨</h2>
      <div class="list-controls">
        <span id="storage-info" class="storage-info">åŠ è½½ä¸­...</span>
        <button class="btn btn-secondary" onclick="refreshFileList()">
          ğŸ”„ åˆ·æ–°
        </button>
        <button class="btn btn-danger" onclick="clearAllFiles()">
          ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰
        </button>
        <button class="btn btn-warning" onclick="manualCleanup()">
          ğŸ§¹ æ¸…ç†è¿‡æœŸ
        </button>
      </div>
    </div>

    <div class="section-content">
      <div class="file-list" id="file-list">
        <div class="loading-message">æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...</div>
      </div>
    </div>
  </section>

  <!-- æ–‡ä»¶é¢„è§ˆæ¨¡æ€æ¡† -->
  <div id="preview-modal" class="modal" style="display: none">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="preview-title">æ–‡ä»¶é¢„è§ˆ</h3>
        <button class="close-btn" onclick="closePreviewModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="preview-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closePreviewModal()">
          å…³é—­
        </button>
      </div>
    </div>
  </div>
  {% endblock %} {% block scripts %}
  <script>
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener("DOMContentLoaded", function () {
      initializeApp();
    });

    // ä¼ é€’æœåŠ¡å™¨ä¿¡æ¯åˆ°JavaScript
    window.serverInfo = {
      url: "{{ server_url }}",
      localIp: "{{ local_ip }}",
    };
  </script>
</main>
{% endblock %}
