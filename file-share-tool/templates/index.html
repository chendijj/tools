{% extends "base.html" %} {% block title %}🗂️ 局域网文件分享工具{% endblock %}
{% block content %}
<header class="header">
  <div class="title-section">
    <div class="title-left">
      <span class="icon">🗂️</span>
      <h1>局域网文件分享工具</h1>
    </div>

    <div class="server-info">
      <div class="server-url-section">
        <div class="url-display">
          <span id="server-url">{{ server_url }}</span>
          <button class="copy-btn" onclick="copyServerUrl()" title="复制地址">
            📋
          </button>
        </div>
      </div>

      <div class="qr-section">
        <button class="qr-btn" onclick="toggleQRCode()" title="显示二维码">
          📱
        </button>
        <div
          id="qr-code-container"
          class="qr-code-container"
          style="display: none"
        >
          <img
            id="qr-code"
            src="data:image/png;base64,{{ qr_code }}"
            alt="二维码"
          />
          <p>扫码访问</p>
        </div>
      </div>
    </div>
  </div>
  <p class="subtitle">简单快捷的文件分享和文本编辑工具</p>
</header>

<main class="main-content">
  <!-- 文件上传区域 -->
  <section class="upload-section">
    <div class="section-header">
      <h2>📤 文件上传</h2>
    </div>
    <div class="section-content">
      <div class="upload-area" id="upload-area">
        <div class="upload-content">
          <span class="upload-icon">📁</span>
          <p class="upload-text">拖拽文件/文件夹到此处或点击选择</p>
          <p class="upload-hint">支持多文件和文件夹上传，单文件最大100MB</p>
          <p class="upload-hint">💡 文件夹上传将保持目录结构，下载时可按文件夹打包</p>
          <input type="file" id="file-input" multiple hidden />
          <input type="file" id="folder-input" webkitdirectory="true" multiple hidden />
          <div class="upload-buttons">
            <button
              class="upload-btn"
              id="select-files-btn"
              title="选择一个或多个文件上传"
            >
              📄 选择文件
            </button>
            <button
              class="upload-btn upload-btn-secondary"
              id="select-folder-btn"
              title="选择整个文件夹上传，保持文件夹结构"
            >
              📁 选择文件夹
            </button>
          </div>
        </div>
      </div>

      <div class="upload-progress" id="upload-progress" style="display: none">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <span class="progress-text" id="progress-text">上传中...</span>
      </div>
    </div>
  </section>

  <!-- 文本编辑器 -->
  <section class="text-editor-section">
    <div class="section-header">
      <h2>📝 文本编辑器</h2>
    </div>
    <div class="section-content">
      <div class="editor-controls">
        <input
          type="text"
          id="text-filename"
          placeholder="文件名.txt"
          value="新建文本.txt"
        />
        <button class="btn btn-primary" onclick="saveTextFile()">
          💾 保存
        </button>
        <button class="btn btn-secondary" onclick="clearEditor()">
          🗑️ 清空
        </button>
      </div>
      <textarea id="text-editor" placeholder="在此输入文本内容..."></textarea>
    </div>
  </section>

  <!-- 文件列表 -->
  <section class="file-list-section">
    <div class="section-header">
      <h2>📁 文件列表</h2>
      <div class="list-controls">
        <span id="storage-info" class="storage-info">加载中...</span>
        <button id="batch-mode-toggle" class="btn btn-secondary" onclick="toggleBatchMode()">
          ☑️ 批量操作
        </button>
        <button class="btn btn-secondary" onclick="refreshFileList()">
          🔄 刷新
        </button>
        <button class="btn btn-danger" onclick="clearAllFiles()">
          🗑️ 清空所有
        </button>
      </div>
    </div>

    <!-- 批量操作控件 -->
    <div id="batch-controls" class="batch-controls" style="display: none;">
      <div class="batch-info">
        <span id="selection-count">已选择 0 个文件</span>
      </div>
      <div class="batch-actions">
        <button class="btn btn-secondary" onclick="toggleSelectAll()">
          🔄 全选/取消
        </button>
        <button id="batch-download" class="btn btn-success" onclick="batchDownloadFiles()" disabled>
          📦 批量下载
        </button>
        <button id="batch-delete" class="btn btn-danger" onclick="batchDeleteFiles()" disabled>
          🗑️ 批量删除
        </button>
      </div>
    </div>

    <div class="section-content">
      <div class="folder-list" id="folder-list">
        <!-- 文件夹列表将在这里显示 -->
      </div>
      <div class="file-list" id="file-list">
        <div class="loading-message">正在加载文件列表...</div>
      </div>
    </div>
  </section>

  <!-- 文件预览模态框 -->
  <div id="preview-modal" class="modal" style="display: none">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="preview-title">文件预览</h3>
        <button class="close-btn" onclick="closePreviewModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="preview-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closePreviewModal()">
          关闭
        </button>
      </div>
    </div>
  </div>
  {% endblock %} {% block scripts %}
  <script>
    // 页面加载完成后初始化
    document.addEventListener("DOMContentLoaded", function () {
      initializeApp();
    });

    // 传递服务器信息到JavaScript
    window.serverInfo = {
      url: "{{ server_url }}",
      localIp: "{{ local_ip }}",
    };
  </script>
</main>
{% endblock %}
